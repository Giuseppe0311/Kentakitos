<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />        <!-- Enlaces a los archivos CSS y JS de Flatpickr -->
  </head>
  <body>
    <main>
      <nav class="navbar bg-light" aria-label="Light offcanvas navbar">
        <div class="container-fluid">
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasNavbarLight"
            aria-controls="offcanvasNavbarLight"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <!-- make a buttom for logout and add styles and icon -->
        <a class="nav-link active" aria-current="page" href="/user/logout">
         <button class="btn btn-danger">
      <i class="fas fa-sign-out-alt"></i> Logout
         </button>
        </a>



          <div
            class="offcanvas offcanvas-start"
            tabindex="-1"
            id="offcanvasNavbarLight"
            aria-labelledby="offcanvasNavbarLightLabel"
          >
            <div class="offcanvas-header">
              <h5 class="offcanvas-title" id="offcanvasNavbarLightLabel">
                Kentakitos
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="offcanvas"
                aria-label="Close"
              ></button>
            </div>
            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
              <!-- make a buttom for home and add styles and icon  -->
              <!-- make a buttom for home and add styles and icon -->
            <li class="nav-item">
               <a class="nav-link active" aria-current="page" href="/dashboard">
    <button class="btn btn-primary">
      <i class="fas fa-home"></i> Home
    </button>
  </a>
</li>
 
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    USUARIOS
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="/user/admin/register">Registrar Usuarios</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/user/admin/permission">Asignar Permisos</a>
                    </li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    PRODUCTOS
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="/productos">Registrar Productos</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/categorias">Registrar Categorias</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/proveedores"
                        >Registrar Proveedores</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="/marcas"
                        >Registrar Marcas</a
                      >
                    </li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    COMPRAS
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="/compras"> Registar Compras</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/detallecompras"> Mis Compras</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/allpagos"> Mis Pagos</a>
                    </li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    VENTAS
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="/menues"> Registar Menu</a>
                    </li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    REPORTES
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="/ReporteProveedores"> Reporte Proveedores</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteVentas">Reporte Ventas</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteCompras">Reporte Compras</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReportePagos">Reporte Pagos</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteMenues">Reporte Menus</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteProductos">Reporte Productos</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteMarcas">Reporte Marcas</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteCategorias">Reporte Categorias</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteUsuarios">Reporte Usuarios</a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
      <!-- aqui empieza el contenido -->
      <div class="container">
        <div class="bg-light p-2">
          <div class="col-sm-12 py-5">
            <h1 class="display-5 fw-normal text-center">HOME</h1>
            <hr />
            <div class="container overflow-hidden text-center">
              <div class="row gy-5">
                <div class="col-12 col-xl-6">
                  <div class="container d-flex justify-content-center align-items-center flex-column">
                    <div class="p-3">Reporte  de Ventas</div>
                    <canvas id="myChart" style="max-width: 400px; height: 300px;"></canvas>
                  </div>
                </div>
                <div class="col-12 col-xl-6">
                  <div class="row gy-3">
                    <div class="col-12 col-lg-6 ">
                      <div class="container d-flex justify-content-center align-items-center flex-column">
                        <div class="p-3">Reporte de Ventas por Categorias</div>
                        <canvas id="myChart1"></canvas>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6">
                      <div class="container d-flex justify-content-center align-items-center flex-column">
                        <div class="p-3">Reporte de Pagos</div>
                        <canvas id="myChart2"></canvas>
                        </div>
                    </div>
                    <div class="col-12">
                      <div class="container d-flex justify-content-center align-items-center flex-column">
                        <div class="p-3">Reporte de Datos</div>
                        <canvas id="myChart3"></canvas>
                      </div>
                    </div>
                  </div>
              </div>
            </div>
            <!--  -->
          </div>
        </div>
      </div>
    </main>
    <script>
      async function fetchData() {
        let categorias = [];
        let repeticionesCategorias = [];
        let repeticiones = {};
        const ventasPorFecha = {};
        try {
          const response = await axios.get("/detallMenus")
          const detalleMenus = response.data
          detalleMenus.forEach((menus) => {
            const fechaVenta = menus.fecha_registro.slice(0, 10);
    const { nombre } = menus;
    const { categoria } = menus;
    repeticiones[nombre] = repeticiones[nombre] ? repeticiones[nombre] + 1 : 1;
    if (!categorias.includes(categoria)) {
      categorias.push(categoria);
      repeticionesCategorias.push(1);
    } else {
      const index = categorias.indexOf(categoria);
      repeticionesCategorias[index]++;
    }
    if (!ventasPorFecha[fechaVenta]) {
    ventasPorFecha[fechaVenta] = 1;
  } else {
    ventasPorFecha[fechaVenta] += 1;
  }
  });
  // Obtener el array de nombres Ãºnicos de productos
  const nombresUnicos = Object.keys(repeticiones);
  
  // Obtener el array de repeticiones correspondientes
  const repeticionesArray = Object.values(repeticiones);
  const fechas = Object.keys(ventasPorFecha);
const cantidadesVentas = Object.values(ventasPorFecha);

console.log(fechas);
console.log(cantidadesVentas);
  
    var myChart = new Chart(document.getElementById("myChart"), {
    type: "doughnut",
    data: {
      labels: nombresUnicos,
      datasets: [{
        label: "Ventas",
        data: repeticionesArray,
        fill: false,
        lineTension: 0.3
      }]
    },
  
  });
  
  var myChart1 = new Chart(document.getElementById("myChart1"), {
    type: "bar",
    data: {
      labels:categorias,
      datasets: [{
        label: "Categorias",
        data: repeticionesCategorias,
        fill: false,
        barPercentage: 0.6
      }]
    },
  });
  var myChart1 = new Chart(document.getElementById("myChart2"), {
    type: "bar",
    data: {
      labels: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio"],
      datasets: [{
        label: "Pagos",
        data: [10, 20, 30, 40, 50, 60],
        fill: false,
        barPercentage: 0.6
      }]
    },
  });
  var myChart1 = new Chart(document.getElementById("myChart3"), {
    type: "line",
    data: {
      labels: fechas,
      datasets: [{
        label: "Ventas",
        data: cantidadesVentas,
        backgroundColor: "rgba(75, 192, 192, 0.2)",
        borderColor: "rgba(75, 192, 192, 1)",
        borderWidth: 1,
        fill: false,
        barPercentage: 0.6
      }]
    },
  });
  } catch(error){
          console.log(error)
  }
      }
      fetchData()
      </script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
  </script>
  </body>
</html>