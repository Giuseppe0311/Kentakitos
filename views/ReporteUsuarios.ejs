<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reporte Usuarios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
    <style>
      @media print {
        table {
          table-layout: fixed;
        }
        
        td, th {
          word-wrap: break-word;
          white-space: normal !important;
          font-size: 8px; /* Ajusta el tamaño de la fuente según tus preferencias */
        }
      }
    </style>
  </head>
  <body>
    <main>
      <nav class="navbar bg-light" aria-label="Light offcanvas navbar">
        <div class="container-fluid">
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasNavbarLight"
            aria-controls="offcanvasNavbarLight"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <!-- make a buttom for logout and add styles and icon -->
        <a class="nav-link active" aria-current="page" href="/user/logout">
         <button class="btn btn-danger">
      <i class="fas fa-sign-out-alt"></i> Logout
         </button>
        </a>



          <div
            class="offcanvas offcanvas-start"
            tabindex="-1"
            id="offcanvasNavbarLight"
            aria-labelledby="offcanvasNavbarLightLabel"
          >
            <div class="offcanvas-header">
              <h5 class="offcanvas-title" id="offcanvasNavbarLightLabel">
                Kentakitos
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="offcanvas"
                aria-label="Close"
              ></button>
            </div>
            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
              <!-- make a buttom for home and add styles and icon  -->
              <!-- make a buttom for home and add styles and icon -->
            <li class="nav-item">
               <a class="nav-link active" aria-current="page" href="/dashboard">
    <button class="btn btn-primary">
      <i class="fas fa-home"></i> Home
    </button>
  </a>
</li>
 
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    USUARIOS
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="/user/admin/register">Registrar Usuarios</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/user/admin/permission">Asignar Permisos</a>
                    </li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    PRODUCTOS
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="/productos">Registrar Productos</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/categorias">Registrar Categorias</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/proveedores"
                        >Registrar Proveedores</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="/marcas"
                        >Registrar Marcas</a
                      >
                    </li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    COMPRAS
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="/compras"> Registar Compras</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/detallecompras"> Mis Compras</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/allpagos"> Mis Pagos</a>
                    </li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    VENTAS
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="/menues"> Registar Menu</a>
                    </li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    REPORTES
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="/ReporteProveedores"> Reporte Proveedores</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteVentas">Reporte Ventas</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteCompras">Reporte Compras</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReportePagos">Reporte Pagos</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteMenues">Reporte Menus</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteProductos">Reporte Productos</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteMarcas">Reporte Marcas</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteCategorias">Reporte Categorias</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="/ReporteUsuarios">Reporte Usuarios</a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
      <!-- aquí empieza el contenido -->
      <div class="container">
        <div class="bg-light p-2">
          <div class="col-sm-12 py-5">
            <h1 class="display-5 fw-normal text-center">Reporte de Usuarios</h1>
            <hr />
            <div class="col-sm-12 py-2">
              <label for="fecha-inicial-input" class="form-label">Fecha inicial:</label>
              <input type="date" id="fecha-inicial-input" class="form-control">
            </div>
            <div class="col-sm-12 py-2">
              <label for="fecha-final-input" class="form-label">Fecha final:</label>
              <input type="date" id="fecha-final-input" class="form-control">
            </div>
            <div class="col-sm-12 py-2">
              <button id="filtrar-btn" class="btn btn-primary">Filtrar</button>
              <button id="mostrar-todo-btn" class="btn btn-secondary">Mostrar Todo</button>
            </div>
            <div>
              <table class="table caption-top table-light table-striped" id="mitabla">
                <thead class="table-dark">
                  <tr>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th>Correo</th>
                    <th>DNI</th>
                    <th>Telefono</th>
                    <th>Direccion</th>
                    <th>Perfil</th>
                    <th>Fecha_registro</th>
                  </tr>
                </thead>
                <tbody>            
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.colVis.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.flash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script>
      let originalData = []; // Variable para almacenar los datos originales
    
      async function mostrarProveedores() {
        const response = await axios.get("/usuarios4rep");
        const dataproveedores = response.data;
        originalData = dataproveedores.slice(); // Guardar una copia de los datos originales
        const tabla = document.getElementById("mitabla");
        const tbody = tabla.querySelector("tbody");
    
        // Vaciar el contenido de la tabla
        tbody.innerHTML = "";
    
        // Recorrer el array de proveedores seleccionados y agregar filas a la tabla
        dataproveedores.forEach((proveedor) => {
          const fila = document.createElement("tr");
          fila.innerHTML = `
            <td>${proveedor.nombres}</td>
            <td>${proveedor.apellidos}</td>
            <td>${proveedor.correo}</td>
            <td>${proveedor.dni}</td>
            <td>${proveedor.celular}</td>
            <td>${proveedor.direccion}</td>
            <td>${proveedor.perfil}</td>
            <td>${moment(proveedor.fecha_registro).format('DD/MM/YYYY')}</td>
          `;
          tbody.appendChild(fila);
        });
    
        $(document).ready(function() {
          var table = $('#mitabla').DataTable({
            dom: 'Bfrtip',
            buttons: [
              {
                extend: 'pdf',
                orientation: 'landscape',
                exportOptions: {
                  columns: ':visible'
                }
              },
              'copy', 'csv', 'excel', 'print'
            ],
            "language": {
              "buttons": {
                "copyTitle": 'Copiado al portapapeles',
                "copySuccess": {
                  _: '%d filas copiadas',
                  1: '1 fila copiada'
                }
              }
            },
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Todos"]],
            "pagingType": "full_numbers",
            "order": [],
            "responsive": true
          });
    
          table.buttons().container().appendTo('#mitabla_wrapper .col-md-6:eq(0)');
    
          // Agregar el evento click al botón "Filtrar"
          $('#filtrar-btn').on('click', function() {
            // Obtener las fechas seleccionadas
            const fechaInicial = $('#fecha-inicial-input').val();
            const fechaFinal = $('#fecha-final-input').val();
    
            // Filtrar los datos en el rango de fechas
            const filteredData = originalData.filter(proveedor => {
              const fechaRegistro = moment(proveedor.fecha_registro, 'YYYY-MM-DD');
              return fechaRegistro.isBetween(fechaInicial, fechaFinal, null, '[]');
            });
    
            // Limpiar la tabla
            table.clear();
    
            // Agregar las filas filtradas a la tabla
            filteredData.forEach(proveedor => {
              table.row.add([
                proveedor.nombres,
                proveedor.apellidos,
                proveedor.correo,
                proveedor.dni,
                proveedor.celular,
                proveedor.direccion,
                proveedor.perfil,
                moment(proveedor.fecha_registro).format('DD/MM/YYYY'),
              ]);
            });
    
            // Dibujar la tabla actualizada
            table.draw();
          });
    
          // Agregar el evento click al botón "Mostrar Todo"
          $('#mostrar-todo-btn').on('click', function() {
            // Limpiar la tabla
            table.clear();
    
            // Agregar las filas originales a la tabla
            originalData.forEach(proveedor => {
              table.row.add([
                proveedor.nombres,
                proveedor.apellidos,
                proveedor.correo,
                proveedor.dni,
                proveedor.celular,
                proveedor.direccion,
                proveedor.perfil,
                moment(proveedor.fecha_registro).format('DD/MM/YYYY'),
              ]);
            });
    
            // Dibujar la tabla actualizada
            table.draw();
            const fechaInicial = $('#fecha-inicial-input').val( "");
            const fechaFinal = $('#fecha-final-input').val("");
            
          });
        });
      }
    
      mostrarProveedores();
    </script>
  </body>
</html>
